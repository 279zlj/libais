#! /usr/bin/env python

import ais
import sys
import json
import ais.compatibility.gpsd
import ais.stream

args = {}
files = []
for arg in sys.argv[1:]:
    if arg.startswith("--"):
        arg = arg[2:]
        if '=' in arg:
            arg, value = arg.split("=", 1)
            args[arg] = value
        else:
            args[arg] = True
    else:
        files.append(arg)

if len(files) != 1 or "help" in args:
    print """Usage: aisdecode [OPTIONS] < INFILE.nmea > OUTFILE.json
Available opptions:
    --gpsd Use gpsd compatible output
"""

for msg in ais.stream.decode(sys.stdin):
    if args.get("gpsd", False):
        msg = ais.compatibility.gpsd.mangle(msg)
    json.dump(msg, sys.stdout)
    sys.stdout.write("\n")

# -*- makefile -*-
VERSION:=${shell cat VERSION}

default:
	@echo
	@echo
	@echo "        Welcome to libais ${VERSION}"
	@echo
	@echo "Build options:"
	@echo
	@echo "  clean    - remove all objects and executables"
	@echo "  all      - build everything"
	@echo "  tar      - create a release source tar using VERSION"
	@echo
	@echo "  python   - build the python module"
	@echo "  test     - Simple C++ library test"
	@echo "  python2  - build the python2.6 module"
	@echo "  python3  - build the python3.1 module"
	@echo
	@echo "  pull     - update from github"
	@echo "  push     - update github with local changes"
	@echo 
	@echo "Read the README for more information"

all: python2 python3
	(cd src; make -f Makefile-custom all) 

DIST:=libais-${shell cat VERSION}
TAR:=${DIST}.tar
tar:
	rm -f ${TAR}.bz2 ${TAR}
	rm -rf ${DIST}
	mkdir ${DIST}
	cp -rp src test [A-Z]* *.py ${DIST}/
	tar cf ${TAR} ${DIST}
	bzip2 -9 ${TAR}
	rm -rf ${DIST}


python2:
	CFLAGS="-O3 -funroll-loops -fexpensive-optimizations -ffast-math" python2 setup.py build

python3:
	CFLAGS="-std=c++11 -O0 -g -UNDEBUG" python3 setup.py build

clean:
	(cd ais && make -f Makefile-custom clean) 
	(cd src && make -f Makefile-custom clean) 
	(cd test && make -f Makefile-custom clean) 
	-rm -rf build
	rm -f _ais.so

test:
	(cd src; make -f Makefile-custom test) 

# Hard coded depends
src/libais/ais.o: src/libais/ais.h
src/libais/ais123.o: src/libais/ais.h
src/libais/ais4_11.o: src/libais/ais.h
src/libais/ais5.o: src/libais/ais.h
src/libais/ais6.o: src/libais/ais.h
src/libais/ais7_13.o: src/libais/ais.h
src/libais/ais8_001_22.o: src/libais/ais.h 
src/libais/ais9.o: src/libais/ais.h
src/libais/ais10.o: src/libais/ais.h
src/libais/ais12.o: src/libais/ais.h
src/libais/ais14.o: src/libais/ais.h
src/libais/ais15.o: src/libais/ais.h
src/libais/ais16.o: src/libais/ais.h
src/libais/ais17.o: src/libais/ais.h
src/libais/ais18.o: src/libais/ais.h
src/libais/ais19.o: src/libais/ais.h
src/libais/ais20.o: src/libais/ais.h
src/libais/ais21.o: src/libais/ais.h
src/libais/ais22.o: src/libais/ais.h
src/libais/ais23.o: src/libais/ais.h
src/libais/ais24.o: src/libais/ais.h
src/libais/ais25.o: src/libais/ais.h
src/libais/ais26.o: src/libais/ais.h
src/libais/ais27.o: src/libais/ais.h
src/libais/ais_py.o: src/libais/ais.h
test_libsrc/libais/ais.o: src/libais/ais.h

GIT_URL:=git@github.com:schwehr/libais.git

pull:
	git pull ${GIT_URL}

push:
	git push ${GIT_URL}
